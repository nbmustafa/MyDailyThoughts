You’re absolutely right to call this out — the registry_login block I previously suggested doesn’t actually exist in the Terraform Helm provider. Thanks for prompting a second look!

What the Helm Provider Actually Supports

Reviewing the official Terraform documentation and community examples, here’s how it handles OCI registries:

Provider configuration supports a registries block (formerly registry in older versions). This isn't a dynamic login but requires static credentials:
'''
provider "helm" {
  kubernetes {
    config_path = "~/.kube/config"
  }

  registries = [
    {
      url      = "oci://private.registry"
      username = "username"
      password = "password"
    }
  ]
}

'''
This is confirmed by both the Helm docs and HashiCorp’s Helm provider upgrade guide, which details the shift to registries list blocks for Terraform Plugin Framework versions .

No built-in dynamic login mechanism such as registry_login exists. Attempts to rely solely on Terraform for ECR OCI auth have been problematic, as illustrated in GitHub issue discussions. Users resort to workaround patterns like null_resource invoking helm registry login via local-exec, often using AWS ECR authorization tokens .



---

Recommended Pattern for Dynamic ECR Login

Since Terraform doesn't support dynamic registry login out-of-the-box, here's a robust workaround:

'''
data "aws_ecr_authorization_token" "token" {}

resource "null_resource" "helm_login" {
  triggers = {
    always_run = timestamp()
  }

  provisioner "local-exec" {
    command = <<-EOT
      HELM_EXPERIMENTAL_OCI=1 \
      helm registry login \
        --username ${data.aws_ecr_authorization_token.token.user_name} \
        --password ${data.aws_ecr_authorization_token.token.password} \
        ${data.aws_ecr_authorization_token.token.proxy_endpoint}
    EOT
  }
}

resource "helm_release" "my_app" {
  depends_on = [null_resource.helm_login]

  name       = "my-app"
  repository = "oci://${chomp(data.aws_ecr_authorization_token.token.proxy_endpoint)}/helm-charts"
  chart      = "my-chart"
  version    = "1.2.3"
  namespace  = "default"
}
'''

This uses Terraform's AWS provider to fetch the ECR token.

The null_resource ensures Helm OCI registry is logged in right before pulling the chart.

helm_release depends on this, ensuring reliable authentication.


This pattern aligns with real-world experiences and community practices when integrating Helm with ECR .


---

Summary Table

Feature	Supported?	Notes

registry_login block	No	Not in Terraform Helm provider schema.
registries block	Yes	Requires static username/password for each registry. 
Dynamic ECR helm login	No	Must use external shell (e.g., helm registry login) workaround. 



---

Takeaway

My earlier suggestion about registry_login was inaccurate—sorry for that oversight.

The provider only supports static credentials via registries.

For dynamic ECR access, the most reliable way in Terraform remains via null_resource + local-exec to run helm registry login, possibly using AWS-provided tokens.


Want help integrating this cleanly into your GitHub Actions pipeline or consolidating it in a Terraform module?

Secure ECR Authentication for Terraform Helm Provider

As a Principal DevOps Engineer, here's the improved approach for ECR authentication without username/password:

```hcl
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
    helm = {
      source  = "hashicorp/helm"
      version = "~> 2.9.0"
    }
  }
}

provider "aws" {
  region = "us-east-1" # Replace with your region
}

# Get ECR authentication token
data "aws_ecr_authorization_token" "token" {}

provider "helm" {
  kubernetes {
    config_path = "~/.kube/config" # Adjust based on your k8s config
  }

  registry {
    url = data.aws_ecr_authorization_token.token.proxy_endpoint
    username = data.aws_ecr_authorization_token.token.user_name
    password = data.aws_ecr_authorization_token.token.password
  }
}

# Example Helm release from ECR
resource "helm_release" "example" {
  name       = "my-chart"
  repository = "oci://${data.aws_ecr_authorization_token.token.proxy_endpoint}"
  chart      = "my-repo/my-chart" # Replace with your ECR repository and chart
  version    = "1.0.0"
}
```

Key Improvements:

1. AWS ECR Integration: Uses AWS provider to automatically generate temporary credentials
2. IAM-Based Authentication: Leverages AWS IAM roles instead of static credentials
3. No Hardcoded Secrets: Eliminates the need for username/password variables
4. Automatic Token Refresh: AWS provider handles token expiration automatically

Implementation Notes:

1. Ensure your AWS credentials are properly configured (via environment variables, IAM instance roles, or AWS CLI configuration)
2. The ECR repository must already exist and contain your Helm charts
3. The Kubernetes cluster must have network access to your ECR registry
4. IAM policies must grant appropriate permissions for ECR access

Required IAM Permissions:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ecr:GetAuthorizationToken",
        "ecr:BatchCheckLayerAvailability",
        "ecr:GetDownloadUrlForLayer",
        "ecr:BatchGetImage"
      ],
      "Resource": "*"
    }
  ]
}
```

This approach provides secure, temporary credentials without manual credential management, following AWS best practices for authentication.